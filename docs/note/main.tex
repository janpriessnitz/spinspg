\documentclass[a4paper, 11pt]{article}

% add warnings
\RequirePackage[l2tabu, orthodox]{nag}
\usepackage[all, warning]{onlyamsmath}

%codification of the document
\usepackage[utf8]{inputenc}
% font
\usepackage{newtxtext}  % Times and Helvetica
% mathematical features
\usepackage{amsmath, amssymb}
\usepackage{amsthm}
\theoremstyle{definition}
\usepackage{mathtools}
% screen
\usepackage{ascmac}
% url
\usepackage{url}
% for images
\usepackage{graphicx}
% chemical formula
\usepackage[version=3]{mhchem}
% appendix
\usepackage[toc,page]{appendix}
% add bibliography in TOC
\usepackage[nottoc]{tocbibind}
% hyperlink
\usepackage[svgnames,psnames]{xcolor} % better color for hyperref
\usepackage[colorlinks,citecolor=DarkGreen,linkcolor=FireBrick,linktocpage,unicode]{hyperref} % add hypertext capabilities
% color
\usepackage{color}
% page size and margins
\usepackage{geometry}
% citation
\usepackage{cite}
% Tikz
\usepackage{tikz}
\usetikzlibrary{positioning,arrows.meta,shapes}

\usepackage{bm}

% *matter for article class
% https://tex.stackexchange.com/questions/154646/is-there-an-easy-way-to-get-the-frontmatter-mainmatter-and-backmatter-in-a-l
\makeatletter
\newcommand\frontmatter{%
  \cleardoublepage
  %\@mainmatterfalse
  \pagenumbering{roman}}
\newcommand\mainmatter{%
  \cleardoublepage
  % \@mainmattertrue
  \pagenumbering{arabic}}
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Macros
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% follow https://cdn.journals.aps.org/files/styleguide-pr.pdf
\newcommand{\secref}[1]{Section~\ref{#1}}
\newcommand{\appendixref}[1]{Appendix~\ref{#1}}
\newcommand{\software}[1]{\texttt{#1}}

\newcommand{\term}[1]{\textit{#1}}
\newcommand{\todo}[1]{\textcolor{red}{TODO: #1}}
\newcommand{\norm}[1]{\left\lVert#1\right\rVert}
% https://zrbabbler.hatenablog.com/entry/20120411/1334151482
\newcommand{\relmiddle}[1]{\mathrel{}\middle#1\mathrel{}}
\newcommand{\set}[2]{\left\{ #1 \relmiddle| #2 \right\}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\R}{\mathbb{R}}
\DeclareMathOperator*{\argmin}{arg\,min}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{definition}[theorem]{Definition}

\title{Spin space group}
\author{Kohei Shinohara}
\date{\today}

\begin{document}
\maketitle
\tableofcontents

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Spin arrangement and spin symmetry operation}

A \term{spin symmetry operation} $(\bm{W}, g) \in O(3) \times E(3)$ acts on a pair of magnetic moments $\bm{m}$ and position $\bm{r}$,
\begin{align}
  (\bm{W}, g) (\bm{m}, \bm{r}) \coloneqq (\bm{Wm}, g \bm{r}).
\end{align}
A \term{spin arrangement} is a set of pairs of magnetic moments and point coordinates.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Structure of spin space group}

\subsection{Spin space group}

A spin space group \cite{doi:10.1063/1.1708514,doi:10.1098/rspa.1966.0211,LITVIN1974538,Opechowski1986} is used to classify spin symmetry operations of spin arrangements.

\begin{screen}
  \begin{definition}[Spin space group]
    Let $\mathcal{G}$ be a subgroup of $\mathrm{O}(3) \times \mathrm{E}(3)$.
    When the following $\mathcal{F}(\mathcal{G})$ and $\mathcal{D}(\mathcal{G})$ are space groups, $\mathcal{G}$ is a \term{spin space group},
    \begin{align}
      \mathcal{F}(\mathcal{G})
        &\coloneqq \set{ g \in \mathrm{E}(3) }{ \exists \bm{W} \in \mathrm{O}(3) \,s.t.\, (\bm{W}, g) \in \mathcal{G} } \\
      \mathcal{D}(\mathcal{G})
        &\coloneqq \set{ g \in \mathrm{E}(3) }{ (\bm{E}, g) \in \mathcal{G} }.
    \end{align}
    For a spin space group $\mathcal{G}$, we call $\mathcal{F}(\mathcal{G})$ a \term{family space group} and $\mathcal{D}(\mathcal{G})$ a \term{maximal space subgroup}.
  \end{definition}
\end{screen}

\begin{screen}
  \begin{definition}[Spin-space-group type]
    Two spin space groups $\mathcal{G}_{1}$ and $\mathcal{G}_{2}$ belong to the same \term{spin-space-group type} if they are transformed to the other by an orientation-preserving transformation:
    \begin{align}
      \mathcal{G}_{1} \sim \mathcal{G}_{2}
      \overset{\mathrm{def}}{\Longleftrightarrow}
      \exists (\bm{P}, \bm{p}) \,s.t.\, (\bm{P}, \bm{p})^{-1} \mathcal{G}_{1} (\bm{P}, \bm{p}) = \mathcal{G}_{2},
    \end{align}
    where we define the action of transformations to a spin symmetry $(\bm{W}, g)$ as
    \begin{align}
      (\bm{P}, \bm{p})^{-1} (\bm{W}, g) (\bm{P}, \bm{p})
      \coloneqq
      (\bm{P}^{-1}\bm{W}\bm{P}, (\bm{P}, \bm{p})^{-1} g (\bm{P}, \bm{p})).
    \end{align}
  \end{definition}
\end{screen}

\subsection{Spin-only group}

\begin{screen}
  \begin{definition}[Spin-only group]
    Let $\mathcal{G}$ be a spin space group.
    A \term{spin-only group} of $\mathcal{G}$ is
    \begin{align}
      \mathcal{P}_{\mathrm{so}}(\mathcal{G})
      \coloneqq
      \set{ \bm{W} \in \mathrm{O}(3) }{ (\bm{W}, (\bm{E}, \bm{0})) \in \mathcal{G} }.
    \end{align}
  \end{definition}
\end{screen}

A spin-only group $\mathcal{P}_{\mathrm{so}}(\mathcal{G})$ is a normal subgroup of $\mathcal{G}$, $\mathcal{P}_{\mathrm{so}}(\mathcal{G}) \times 1 \trianglelefteq \mathcal{G}$.

When a spin space group $\mathcal{G}$ is a stabilizer of a spin arrangement, spin-only groups are classified as Table~\ref{tab:spin_only_group} \cite{LITVIN1974538,PhysRevX.12.021016}.

\begin{table}[tb]
  \centering
  \caption{Classification of spin-only groups}
  \label{tab:spin_only_group}
  \begin{tabular}{cc}
    \hline \hline
    Spin-only group & Spin arrangement \\
    \hline
    $\infty \infty / m \cong \mathrm{O}(3)$ & Nonmagnetic \\
    $\infty / m \cong \mathrm{SO}(2) \rtimes \mathbb{Z}_{2} $ & Collinear \\
    $m$ & Coplanar \\
    $1$ & Noncoplaner \\
    \hline \hline
  \end{tabular}
\end{table}

\subsection{Spin translation group}

\begin{screen}
  \begin{definition}[Spin translation group]
    Let $\mathcal{G}$ be a spin space group.
    A \term{spin translation group} of $\mathcal{G}$ is
    \begin{align}
      \mathcal{G}_{\mathrm{st}}(\mathcal{G})
      \coloneqq
      \set{ (\bm{W}, (\bm{E}, \bm{v})) }{ (\bm{W}, (\bm{E}, \bm{v})) \in \mathcal{G}}.
    \end{align}
  \end{definition}
\end{screen}

Reference~\cite{Litvin:a09793} classified the spin translation groups.

We write a translation subgroup and a point group of space group $\mathcal{S}$ as $\mathcal{T}(\mathcal{S})$ and $\mathcal{P}(\mathcal{S})$, respectively,
\begin{align}
  \mathcal{T}(\mathcal{S}) &\coloneqq \set{ (\bm{E}, \bm{t}) }{ (\bm{E}, \bm{t}) \in \mathcal{S} } \\
  \mathcal{P}(\mathcal{S}) &\coloneqq \set{ \bm{W} }{ \exists \bm{v} \, s.t.\, (\bm{W}, \bm{v}) \in \mathcal{S} }.
\end{align}

The spin-only group $\mathcal{P}_{\mathrm{so}}(\mathcal{G})$ is a normal subgroup of $\mathcal{G}_{\mathrm{st}}(\mathcal{G})$.
A translation subgroup of $\mathcal{D}(\mathcal{G})$ is also a normal subgroup of $\mathcal{G}_{\mathrm{st}}(\mathcal{G})$.
Because $(\mathcal{P}_{\mathrm{so}}(\mathcal{G}) \times 1) \cap (1 \times \mathcal{T}(\mathcal{D}(\mathcal{G}))) = \{ 1 \}$, we can consider a factor group $\mathcal{G}_{\mathrm{st}}(\mathcal{G}) / (\mathcal{P}_{\mathrm{so}}(\mathcal{G}) \times \mathcal{T}(\mathcal{D}(\mathcal{G})))$.
We write one of the coset decompositions as
\begin{align}
  \mathcal{G}_{\mathrm{st}}(\mathcal{G})
    &= \bigsqcup_{ \bm{v} }
        (\bm{W}_{\bm{v}}, (\bm{E}, \bm{v}))
        \left( \mathcal{P}_{\mathrm{so}}(\mathcal{G}) \times \mathcal{T}(\mathcal{D}(\mathcal{G})) \right),
\end{align}
where we choose $\bm{W}_{\bm{0}} = \bm{E}$.
Because both $\mathcal{T}(\mathcal{D}(\mathcal{G}))$ and $\mathcal{T}(\mathcal{F}(\mathcal{G}))$ are three-dimensional translation subgroups, a factor group $\mathcal{T}(\mathcal{F}(\mathcal{G})) / \mathcal{T}(\mathcal{D}(\mathcal{G}))$ is finite.
Thus, a set of the coset representatives $\{ (\bm{W}_{\bm{v}}, (\bm{E}, \bm{v})) \}_{\bm{v}}$ is finite.
Be careful that $\bm{W}_{\bm{v}}$ may not be a crystallographic rotation in general!

\subsection{Spin point group}

Because $\mathcal{G}_{\mathrm{st}}(\mathcal{G})$ is a normal subgroup of $\mathcal{G}$, we can consider a factor group $\mathcal{G} / \mathcal{G}_{\mathrm{st}}(\mathcal{G})$.
\begin{screen}
  \begin{definition}[Nontrivial spin point group]
    Let $\mathcal{G}$ be a spin space group.
    Consider a factor group $\mathcal{G} / \mathcal{G}_{\mathrm{st}}(\mathcal{G})$ and a corresponding coset decomposition,
    \begin{align}
      \mathcal{G}
        = \bigsqcup_{ \bm{R} \in \mathcal{P}(\mathcal{F}(\mathcal{G})) } (\bm{W}_{\bm{R}}, (\bm{R}, \bm{v}_{\bm{R}})) \mathcal{G}_{\mathrm{st}}(\mathcal{G}),
    \end{align}
    where we choose $\bm{W}_{\bm{E}} = \bm{E}$ and $\bm{v}_{\bm{E}} = \bm{0}$.
    A \term{nontrivial spin point group} of $\mathcal{G}$ is
    \begin{align}
      \mathcal{G}_{\mathrm{nt}}(\mathcal{G})
      \coloneqq
      \set{ (\bm{W}_{\bm{R}}, (\bm{R}, \bm{0})) }{ (\bm{W}_{\bm{R}}, (\bm{R}, \bm{v}_{\bm{R}})) \in \mathcal{G} },
    \end{align}
    which is isomorphic to $\mathcal{G} / \mathcal{G}_{\mathrm{st}}(\mathcal{G})$.
  \end{definition}
\end{screen}

The nontrivial spin point group $\mathcal{G}_{\mathrm{nt}}(\mathcal{G})$ is also finite because point group $\mathcal{P}(\mathcal{F}(\mathcal{G}))$ is finite,
Because the map $\bm{W}_{\bullet}: \mathcal{P}(\mathcal{F}(\mathcal{G})) \to \mathrm{O}(3)$ is linear, there exists a normal subgroup $N \trianglelefteq \mathcal{P}(\mathcal{F}(\mathcal{G}))$ such that $\{ \bm{W}_{\bm{R}} \}_{ \bm{R} \in \mathcal{P}(\mathcal{F}(\mathcal{G})) } \cong \mathcal{P}(\mathcal{F}(\mathcal{G})) / N$.
Thus, spin point groups are classified by 32 crystallographic point groups and their normal subgroups \cite{Litvin:a14103}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Spin symmetry operation search}

A spin arrangement is represented by the following four objects:
(1) basis vectors of its lattice $\bm{A} = (\bm{a}_{1}, \bm{a}_{2}, \bm{a}_{3})$,
(2) an array of point coordinates of sites in its unit cell $\bm{X} = (\bm{x}_{1}, \cdots, \bm{x}_{N})$,
(3) an array of atomic types of sites in its unit cell $\bm{T} = (t_{1}, \cdots, t_{N})$,
and (4) an array of magnetic moments of sites in its unit cell $\bm{M} = (\bm{m}_{1}, \cdots, \bm{m}_{N})$,
where $N$ is the number of sites in the unit cell.

First, we consider a crystal structure $(\bm{A}, \bm{X}, \bm{T})$ obtained by ignoring magnetic moments of $(\bm{A}, \bm{X}, \bm{T}, \bm{M})$.
A space group of $(\bm{A}, \bm{X}, \bm{T})$ is written as a stabilizer subgroup of $\mathrm{E}(3)$ that preserves $(\bm{A}, \bm{X}, \bm{T})$:
\begin{align}
    \mathcal{S}
        &\coloneqq \set{
                g = ( \overline{\bm{R}}, \overline{\bm{v}} )_{\bm{A}} \in \mathrm{E}(3)
            }{
                \begin{array}{l}
                    \overline{\bm{R}} \in \mathbb{Z}^{3 \times 3} \\
                    \exists \sigma_{g} \in \mathfrak{S}_{N}, \forall i, \\
                    \overline{\bm{R}} \bm{x}_{i} + \overline{\bm{v}} \equiv \bm{x}_{\sigma_{g}(i)} \, (\mathrm{mod} \, 1) \\
                    t_{i} = t_{\sigma_{g}(i)}
                \end{array}
            },
\end{align}
where $\mathfrak{S}_{N}$ is a symmetric group of degree $N$ and $( \overline{\bm{R}}, \overline{\bm{v}} )_{\bm{A}} \coloneqq ( \bm{A}\overline{\bm{R}}\bm{A}^{-1}, \bm{A}\overline{\bm{v}} )$ \footnote {
  The condition $\overline{\bm{R}} \in \mathbb{Z}^{3 \times 3}$ corresponds to Spglib's convention to omit symmetry operations that do not preserve a supercell.
}.

Let $\bm{A}_{\mathcal{S}}$ be one of primitive basis vectors for $(\bm{A}, \bm{X}, \bm{T})$.
We write a translation subgroup formed by basis vector $\bm{A}$ as
\begin{align}
  \mathcal{T}_{\bm{A}} \coloneqq \set{ (\bm{E}, \bm{n})_{\bm{A}} }{ \bm{n} \in \mathbb{Z}^{3} }.
\end{align}
Then we consider a finite coset decomposition of $\mathcal{S}$,
\begin{align}
  \mathcal{T}_{\bm{A}_{\mathcal{S}}}
    &= \bigsqcup_{ \overline{ \bm{t} }^{\mathcal{S}} }
      \left( \bm{E}, \overline{ \bm{t} }^{\mathcal{S}} \right)_{ \bm{A}_{\mathcal{S}} }
      \mathcal{T}_{\bm{A}} \\
  \mathcal{S}
    &= \bigsqcup_{
          \overline{\bm{R}}^{\mathcal{S}} \in \bm{A}_{\mathcal{S}}^{-1} \mathcal{P}(\mathcal{S}) \bm{A}_{\mathcal{S}}
      }
      \bigsqcup_{
          \left( \bm{E}, \overline{ \bm{t} }^{\mathcal{S}} \right)_{ \bm{A}_{\mathcal{S}} } \mathcal{T}_{\bm{A}}
          \in \mathcal{T}_{\bm{A}_{\mathcal{S}}} / \mathcal{T}_{\bm{A}}
      }
      \left(
        \overline{\bm{R}}^{\mathcal{S}},
        \overline{ \bm{v} }^{\mathcal{S}}(\overline{\bm{R}}^{\mathcal{S}})
      \right)_{ \bm{A}_{\mathcal{S}} }
      \left( \bm{E}, \overline{ \bm{t} }^{\mathcal{S}} \right)_{ \bm{A}_{\mathcal{S}} }
      \mathcal{T}_{\bm{A}},
\end{align}
where $\overline{ \bm{v} }^{\mathcal{S}}(\overline{\bm{R}}^{\mathcal{S}})$ is a translation part for a rotation $\bm{A}_{\mathcal{S}} \overline{\bm{R}}^{\mathcal{S}} \bm{A}_{\mathcal{S}}^{-1}$.
Note that a point group of $\mathcal{S}$ is $\mathcal{P}(\mathcal{S}) = \{ \bm{A}_{\mathcal{S}} \overline{\bm{R}}^{\mathcal{S}} \bm{A}_{\mathcal{S}}^{-1} \}_{ \overline{\bm{R}}^{\mathcal{S}} }$.

A spin space group of $(\bm{A}, \bm{X}, \bm{T}, \bm{M})$ is written as a stabilizer subgroup of $\mathrm{O}(3) \times \mathrm{E}(3)$ that preserves $(\bm{A}, \bm{X}, \bm{T}, \bm{M})$:
\begin{align}
  \mathcal{G}
    &\coloneqq \set{
      (\bm{W}, g) \in \mathrm{O}(3) \times \mathrm{E}(3)
    }{
        \begin{array}{l}
          \exists \sigma_{g} \in \mathfrak{S}_{N}, \forall i, \\
          g \bm{x}_{i} \equiv \bm{x}_{\sigma_{g}(i)} \, (\mathrm{mod} \, 1) \\
          t_{i} = t_{\sigma_{g}(i)} \\
          \bm{W} \bm{m}_{i} = \bm{m}_{\sigma_{g}(i)}
        \end{array}
    } \\
    &= \set{
      (\bm{W}, g) \in \mathrm{O}(3) \times \mathcal{S}
    }{
        \begin{array}{l}
          \exists \sigma_{g} \in \mathfrak{S}_{N}, \forall i, \\
          g \bm{x}_{i} \equiv \bm{x}_{\sigma_{g}(i)} \, (\mathrm{mod} \, 1) \\
          t_{i} = t_{\sigma_{g}(i)} \\
          \bm{W} \bm{m}_{i} = \bm{m}_{\sigma_{g}(i)}
        \end{array}
    } \\
  \mathcal{D} &\coloneqq \mathcal{D}(\mathcal{G}) \\
  \mathcal{F} &\coloneqq \mathcal{F}(\mathcal{G}).
\end{align}

\subsection{Spin-only group search}

\begin{align}
  \mathcal{P}_{\mathrm{so}}
    &\coloneqq \mathcal{P}_{\mathrm{so}}(\mathcal{G})
    = \set{
        \bm{W} \in \mathrm{O}(3)
      }{
        \bm{W} \bm{m}_{i} = \bm{m}_{i} \,(\forall i)
      }
\end{align}

Consider a moment of inertia tensor of $\bm{M}$,
\begin{align}
  \bm{N} \coloneqq \sum_{i=1}^{N} \bm{m}_{i} \otimes \bm{m}_{i}.
\end{align}
Because $\bm{N}$ is a symmetric semi-definite matrix, we can consider its eigen decomposition,
\begin{align}
  \bm{N} = \sum_{r=1}^{3} \sigma_{r} \hat{\bm{n}}_{r} \otimes \hat{\bm{n}}_{r},
\end{align}
where $\sigma_{1} \geq \sigma_{2} \geq \sigma_{3} \geq 0$ and $\{ \hat{\bm{n}}_{r} \}_{r=1}^{3}$ are orthonormal.

\subsubsection{Nonmagnetic spin arrangement}

When all magnetic moments are zero, the spin arrangement is called \term{nonmagnetic}.
A spin-only group of a nonmagnetic spin arrangement is $\mathcal{P}_{\mathrm{so}} = \mathrm{O}(3)$.
In practice, we compare magnetic moments with a tolerance $\epsilon$,
\begin{align}
  \bm{m}_{i} = \bm{0} \rightarrow \norm{ \bm{m}_{i} }_{2} < \epsilon.
\end{align}

\subsubsection{Collinear spin arrangement}

When a spin arrangement is not nonmagnetic and all magnetic moments are parallel or antiparallel, the spin arrangement is called \term{collinear}.
Let $\hat{\bm{n}}$ be a direction parallel or antiparallel to the magnetic moments.
Let $\hat{\bm{n}}'$ be one of the directions perpendicular to the magnetic moments.
A spin-only group of a collinear spin arrangement is
\begin{align*}
  \mathcal{P}_{\mathrm{so}}
    = \set{ R_{\theta \hat{\bm{n}}} m_{\hat{\bm{n}}'}^{l} }{ 0 \leq \theta < 2 \pi, l=0, 1 }.
\end{align*}
Here $R_{\theta \hat{\bm{n}}}$ is a rotation along axis $\hat{\bm{n}}$ by $\theta$.
$m_{\hat{\bm{n}}'}$ is a mirror operation perpendicular to $\hat{\bm{n}}'$.

When a spin arrangement is collinear, the eigenvector $\hat{\bm{n}}_{1}$ should be parallel or antiparallel to all magnetic moments.
We can check it with tolerance as
\begin{align}
  \forall \theta \in [0, 2 \pi ), l \in \{ 0, 1 \}, R_{\theta \hat{\bm{n}}_{1}} m_{\hat{\bm{n}}_{1}'}^{l} \bm{m}_{i} = \bm{m}_{i}
  \rightarrow
  2 \norm{ \bm{m}_{i} - (\bm{m}_{i} \cdot \hat{\bm{n}}_{1})\hat{\bm{n}}_{1} }_{2} < \epsilon.
\end{align}

\subsubsection{Coplanar spin arrangement}

When a spin arrangement is not collinear and all magnetic moments are perpendicular to $\hat{\bm{n}}$, the spin arrangement is called \term{coplanar}.
A spin-only group of a coplanar spin arrangement is $\mathcal{P}_{\mathrm{so}} = \{ 1, m_{\hat{\bm{n}}} \}$.

When a spin arrangement is coplanar, the eigenvector $\hat{\bm{n}}_{3}$ should be perpendicular to all magnetic moments.
We can check it with tolerance as
\begin{align}
  m_{\hat{\bm{n}}_{3}} \bm{m}_{i} = \bm{m}_{i}
  \rightarrow
  2 \norm{ (\bm{m}_{i} \cdot \hat{\bm{n}}_{3}) \hat{\bm{n}}_{3}}_{2} < \epsilon.
\end{align}

\subsubsection{Noncoplanar spin arrangement}

When a spin arrangement is not coplanar, the spin arrangement is called \term{noncoplanar}.
A spin-only group of a noncoplanar spin arrangement is $\mathcal{P}_{\mathrm{so}} = \{ 1 \}$.

\subsection{Translation subgroup of maximal space subgroup}

\begin{figure}
  \centering
  \begin{tikzpicture}
    \coordinate (TA) at (0, 0);
    \coordinate (TAD) at (0, 2);
    \coordinate (TAS) at (0, 4);
    \coordinate (SD) at (2, 3);
    \coordinate (mid) at (2, 5);
    \coordinate (S) at (4, 6);

    \node at (TA) [left] {$\mathcal{T}_{\bm{A}}$};
    \node at (TAD) [left] {$\mathcal{T}_{\bm{A}_{\mathcal{D}}}$};
    \node at (TAS) [left] {$\mathcal{T}_{\bm{A}_{\mathcal{S}}}$};
    \node at (SD) [right] {$\mathcal{S}_{\mathcal{D}}$};
    \node at (S) [right] {$\mathcal{S}$};

    \fill[black] (TA) circle (2pt);
    \fill[black] (TAD) circle (2pt);
    \fill[black] (TAS) circle (2pt);
    \fill[black] (SD) circle (2pt);
    \fill[black] (mid) circle (2pt);
    \fill[black] (S) circle (2pt);

    \draw (TA) -- (TAD);
    \draw (TAD) -- (TAS);
    \draw (TAD) -- (SD);
    \draw (TAS) -- (mid);
    \draw (SD) -- (mid);
    \draw (mid) -- (S);
  \end{tikzpicture}
  \caption{\label{fig:translation_subgroup}Group-subgroup diagram of translation subgroups derived from spin space group.}
\end{figure}

We write the primitive basis vectors of $\mathcal{T}(\mathcal{D})$ as $\bm{A}_{\mathcal{D}}$.
First, we search for $\mathcal{T}(\mathcal{D}) = \mathcal{T}_{\bm{A}_{\mathcal{D}}} = \set{ (\bm{E}, \bm{v}) }{ (\bm{E}, (\bm{E}, \bm{v})) \in \mathcal{G} }$.
The group-subgroup relationships of translation subgroups are shown in Fig.~\ref{fig:translation_subgroup}.
The two basis vectors $\bm{A}$ and $\bm{A}_{\mathcal{S}}$ are related by an integer matrix as
\begin{align}
  \bm{A} = \bm{A}_{\mathcal{S}} \bm{U} \quad (\bm{U} \in \mathbb{Z}^{3 \times 3}).
\end{align}
Since $\mathcal{T}_{\bm{A}_{\mathcal{D}}}$ is a subgroup of $\mathcal{T}_{\bm{A}_{\mathcal{S}}}$, we only need to check finite coset representatives of $\mathcal{T}_{\bm{A}} / \mathcal{T}_{\bm{A}_{\mathcal{S}}}$ \footnote{
  The transformation matrix $\bm{U}$ can be calculated from centerings in $\mathcal{T}_{\bm{A}_{\mathcal{D}}} / \mathcal{T}_{\bm{A}_{\mathcal{S}}}$ and basis vectors of $\bm{A}_{\mathcal{S}}$.
  Primitive basis vectors of $\mathcal{T}_{\bm{A}_{\mathcal{D}}}$ can be taken from three nonzero vectors from the Hermite normal from of a matrix formed by these centerings and basis vectors of $\bm{A}_{\mathcal{S}}$.
}.
We can find translations in $\mathcal{T}_{\bm{A}_{\mathcal{D}}}$ as
\begin{align}
  \mathcal{T}_{\bm{A}_{\mathcal{S}}}
    &= \set{
      \left( \bm{E}, \overline{ \bm{t} }^{\mathcal{S}} \right)_{ \bm{A}_{\mathcal{S}} }
      }{
        \begin{array}{l}
          \exists \sigma \in \mathfrak{S}_{N}, \forall i, \\
          \bm{x}_{i} + \bm{U}^{-1} \overline{ \bm{t} }^{\mathcal{S}} \equiv \bm{x}_{\sigma(i)} \quad (\mathrm{mod}\, 1) \\
          t_{i} = t_{\sigma(i)} \\
          \bm{m}_{i} = \bm{m}_{\sigma(i)}
        \end{array}
      }
      \times \mathcal{T}_{\bm{A}_{\mathcal{D}}}.
\end{align}
Then, we take one of primitive basis vectors $\bm{A}_{\mathcal{D}}$ of with
\begin{align}
  \bm{A}_{\mathcal{D}}
    &= \bm{A}_{\mathcal{S}} \bm{V} \quad (\bm{V} \in \mathbb{Z}^{3 \times 3}).
\end{align}

\subsection{Spin translation group search}

\begin{figure}
  \centering
  \begin{tikzpicture}
    \coordinate (Pso) at (0, 0);
    \coordinate (PsoTAD) at (0, 2);
    \coordinate (PsoTAS) at (0, 4);
    \coordinate (Gst) at (2, 3);
    \coordinate (mid) at (2, 5);
    \coordinate (O3TAS) at (4, 6);

    \node at (Pso) [left] {$\mathcal{P}_{\mathrm{so}}$};
    \node at (PsoTAD) [left] {$\mathcal{P}_{\mathrm{so}} \times \mathcal{T}_{\bm{A}_{\mathcal{D}}}$};
    \node at (PsoTAS) [left] {$\mathcal{P}_{\mathrm{so}} \times \mathcal{T}_{\bm{A}_{\mathcal{S}}}$};
    \node at (Gst) [right] {$\mathcal{G}_{\mathrm{st}}$};
    \node at (O3TAS) [above] {$\mathrm{O}(3) \times \mathcal{T}_{\bm{A}_{\mathcal{S}}}$};

    \fill[black] (Pso) circle (2pt);
    \fill[black] (PsoTAD) circle (2pt);
    \fill[black] (PsoTAS) circle (2pt);
    \fill[black] (Gst) circle (2pt);
    \fill[black] (mid) circle (2pt);
    \fill[black] (O3TAS) circle (2pt);

    \draw (Pso) -- (PsoTAD);
    \draw (PsoTAD) -- (PsoTAS);
    \draw (PsoTAD) -- (Gst);
    \draw (Gst) -- (mid);
    \draw (PsoTAS) -- (mid);
    \draw (mid) -- (O3TAS);
  \end{tikzpicture}
  \caption{\label{fig:spin_translation_group}Group-subgroup diagram of spin translation group.}
\end{figure}

For coset representatives $(\bm{E}, \bm{v}) \mathcal{T}_{\bm{A}_{\mathcal{D}}} \in \mathcal{T}_{\bm{A}_{\mathcal{S}}} / \mathcal{T}_{\bm{A}_{\mathcal{D}}}$, we search for $\bm{W}_{\bm{v}}$ by solving a Procrustes problem as shown in Appendix~\ref{appx:procrustes}.
% Number of generators for $\{ \bm{W}_{\bm{v}} \}$ can be determined from the Smith normal form of $\bm{V}$.
The group-subgroup relationships for the spin translation group $\mathcal{G}_{\mathrm{st}}$ are shown in Fig.~\ref{fig:spin_translation_group}.

\begin{align}
  \mathcal{G}_{\mathrm{st}}
    &=
      \bigsqcup_{ \overline{\bm{v}}^{\mathcal{D}} }
      \bigsqcup_{
        (\bm{E}, \overline{\bm{t}}^{\mathcal{D}})_{\bm{A}_{\mathcal{D}}} \mathcal{T}_{\bm{A}}
          \in \mathcal{T}_{\bm{A}_{\mathcal{D}}} / \mathcal{T}_{\bm{A}}
      }
        (\bm{W}_{ \overline{\bm{v}}^{\mathcal{D}} }, (\bm{E}, \overline{\bm{v}}^{\mathcal{D}})_{\bm{A}_{\mathcal{D}}})
        (\bm{E}, \overline{\bm{t}}^{\mathcal{D}})_{\bm{A}_{\mathcal{D}}}
        \left(
          \mathcal{P}_{\mathrm{so}} \times \mathcal{T}_{\bm{A}}
        \right)
\end{align}

\subsection{Spin space group search}

Some rotations in $\mathcal{P}(\mathcal{S})$ may not be compatible with $\mathcal{T}_{\bm{A}_{\mathcal{D}}}$.
We write the subgroup of $\mathcal{S}$ which is compatible with $\mathcal{T}_{\bm{A}_{\mathcal{D}}}$ as $\mathcal{S}_{\mathcal{D}}$ and its point group as $\mathcal{P}_{\mathcal{D}}$.

\begin{align}
  \mathcal{P}_{\mathcal{D}}
    &\coloneqq \set{
        \bm{A}_{\mathcal{S}} \overline{\bm{R}}^{\mathcal{S}} \bm{A}_{\mathcal{S}}^{-1} \in \mathcal{P}(\mathcal{S})
      }{
        \bm{V}^{-1} \overline{\bm{R}}^{\mathcal{S}} \bm{V} \in \mathbb{Z}^{3 \times 3}
      }
\end{align}

\begin{align}
  \mathcal{S}_{\mathcal{D}}
    &\coloneqq \bigsqcup_{
          \overline{\bm{R}}^{\mathcal{S}} \in \bm{A}_{\mathcal{S}}^{-1} \mathcal{P}_{\mathcal{D}} \bm{A}_{\mathcal{S}}
      } \bigsqcup_{
          \left( \bm{E}, \overline{ \bm{t} }^{\mathcal{S}} \right)_{ \bm{A}_{\mathcal{S}} } \mathcal{T}_{\bm{A}_{\mathcal{D}}}
          \in \mathcal{T}_{\bm{A}_{\mathcal{S}}} / \mathcal{T}_{\bm{A}_{\mathcal{D}}}
      }
      \left(
        \overline{\bm{R}}^{\mathcal{S}},
        \overline{ \bm{v} }^{\mathcal{S}}(\overline{\bm{R}}^{\mathcal{S}})
      \right)_{ \bm{A}_{\mathcal{S}} }
      \left( \bm{E}, \overline{ \bm{t} }^{\mathcal{S}} \right)_{ \bm{A}_{\mathcal{S}} }
      \mathcal{T}_{\bm{A}_{\mathcal{D}}},
\end{align}

Finally, the coset decomposition of $\mathcal{G}$ by $\mathcal{G}_{\mathrm{st}}$ is finite.
The rotation parts of the coset representatives should belong to the point group of $\mathcal{F}(\mathcal{G})$.
The corresponding spin-rotation parts are determined by solving the Procrustes problem as well.
\begin{align}
  \mathcal{G}
    = \bigsqcup_{ \bm{R} \in \mathcal{P}(\mathcal{F}(\mathcal{G})) } (\bm{W}_{\bm{R}}, (\bm{R}, \bm{v}_{\bm{R}})) \mathcal{G}_{\mathrm{st}}
\end{align}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Symmetrization of spin arrangement}

\todo{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\appendix

\section{\label{appx:procrustes}Procrustes problem}

For $g \in \mathcal{S}$, we consider to search for $\bm{W} \in \mathrm{O}(3)$ such that $\bm{W} \bm{m}_{i} = \bm{m}_{\sigma_{g}(i)}$ for all $i$.
We choose a candidate $\tilde{\bm{W}}$ by solving the following Procrustes problem \cite{10.1093/acprof:oso/9780198510581.001.0001}:
\begin{align}
  \tilde{\bm{W}}
    &=\argmin_{ \bm{W} \in \mathrm{O}(3) } \norm{ \bm{M}_{g} - \bm{W} \bm{M} }_{F} \\
  \bm{M}_{g}
    &\coloneqq \left( \bm{m}_{\sigma_{g}(1)} \cdots \bm{m}_{\sigma_{g}(N)} \right)
    \quad \in \mathbb{R}^{3 \times N}.
\end{align}
We can write $\tilde{\bm{W}}$ with singular value decomposition of $\bm{M}_{g} \bm{M}^{\top}$,
\begin{align}
  \bm{M}_{g} \bm{M}^{\top}
    = \bm{U} \bm{\Sigma} \bm{V}^{\top}
\end{align}
as
\begin{align}
  \tilde{\bm{W}} = \bm{U} \bm{V}^{\top}.
\end{align}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% References
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\bibliographystyle{unsrt}
\bibliography{reference}


\end{document}
